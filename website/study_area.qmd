---
title: "Study Area"
# note we should get the TCSI boundary
# and each watershed in the study area (LTB, King, Sagehen, Caples)
# and then get the layers for each habitat divided by elevation.
# and work from there
format:
  html: 
    fig-height: 10
---

<style>
  .cell-output {
    display: none;
  };
</style>


## Overview Map
```{r study_area}
#| echo: false
#| warning: false
#| message: false
#| error: false
library(dplyr)
library(leaflet)
library(leafem)
library(rgdal)

# TCSI_outline <- readLines("input/TCSI_boundary.geojson") %>% paste(collapse = "\n")
TCSI_outline <- readOGR("input/TCSI_boundary.geojson")
tahoe_outline <- readLines("input/tahoe_outline.geojson") %>% paste(collapse = "\n")
caples_outline <- readLines("input/caples_boundary.geojson") %>% paste(collapse = "\n")

TCSI_popup <- "Tahoe Central Sierra Initiative"
tahoe_popup <- "Lake Tahoe Basin"
caples_popup <- "Caples Creek Watershed"

tcsi_all <- readOGR("input/all.geojson")

palette <- hcl.colors(256, palette = "fall")
palette[1] <- "#0000FF00"

jsCode <- paste0('
 function(el, x, data) {
  var marker = document.getElementsByClassName("leaflet-interactive");
  for(var i=0; i < marker.length; i++){
    (function(){
      var v = data.url[i];
      marker[i].addEventListener("click", function() { window.open(v);}, false);
  }()); 
  }
 }
')

leaflet(tcsi_all) %>%
  addMapPane("outer", zIndex = 420) %>%
  addMapPane("inner", zIndex = 400) %>%
  addTiles("https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}") %>% # Add default OpenStreetMap map tiles
  # addGeotiff("input/f3veg_NLCD_300m_TCSI.tif", opacity = 0.7, colorOptions = colorOptions(
  #     palette = palette,
  #     na.color = "transparent"
  # )) %>%
  addPolygons(weight = 0, fillOpacity = 0.5, opacity = 1, fillColor = ~color, label = ~name, labelOptions = labelOptions(textsize = "1.25em"), options = pathOptions(pane = ~pane)) %>%
  # addGeoJSON(TCSI_outline, weight = 0, fillOpacity = 0.5, opacity = 1, fillColor = "green", label = TCSI_popup) %>%
  setView(lng = -121, lat = 38.5, zoom = 08) %>%
  htmlwidgets::onRender(jsCode, data = tcsi_all@data)
```



## Tahoe Central Sierra Intitiative 

## Lake Tahoe Basin

## Caples Creek Watershed
